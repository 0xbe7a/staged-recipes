context:
  name: drugforge
  version: "0.7.0"
  number: 0
  python_min: "3.11"

recipe:
  name: ${{ name }}
  version: ${{ version }}

source:
  url: https://github.com/choderalab/${{ name }}/archive/refs/tags/${{ version }}.tar.gz
  sha256: 20d72d9b3ad649039b6d37997a227eaa02e9e7da20c35f1ccb5caedd9c22c36d

build:
  number: 0

outputs:
  - package: 
      name: drugforge-data
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-data -vv --no-deps
      skip: True  # [win]
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools >=61.0
        - versioningit
      run:
        - python >=${{ python_min }}
        - biopython
        - boto3
        - click
        - dask
        - dask-jobqueue
        - distributed
        - gufe >=1.0.0
        - mdanalysis
        - moto
        - netifaces
        - numpy
        - openfe ~=1.0
        - openmm
        - pandas
        - plip
        - pydantic >=2.0.0a0
        - pydantic-settings
        - pymol-open-source
        - pyyaml  
        - rdkit
        - requests
        - rich <14.1.0
        - sigfig
        - typing-extensions
        - if: linux
          then:
            - dask-cuda
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.data
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.data
          pip_check: False
          python_version: ${{ python_min }}.*
  - package: 
      name: drugforge-alchemy
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-alchemy -vv --no-deps
      skip: True  # [win]
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools >=61.0
        - versioningit
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
        - alchemiscale-client
        - bokeh
        - cinnabar ~=0.4.1
        - distributed
        - gufe ~=1.4.0
        - lomap2
        - networkx
        - openfe ~=1.4.0
        - openff-models
        - openff-qcsubmit
        - openff-toolkit
        - openff-units
        - openff-utilities
        - panel
        - perses
        - plotmol
        - pooch
        - tqdm
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.alchemy
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.alchemy
          pip_check: False
          python_version: ${{ python_min }}.*
  - package: 
      name: drugforge-cli
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-cli -vv --no-deps
      skip: True  # [win]
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools >=61.0
        - versioningit
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.cli
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.cli
          pip_check: False
          python_version: ${{ python_min }}.*
  - package: 
      name: drugforge-dataviz
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-dataviz -vv --no-deps
      skip: True  # [win]
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools >=61.0
        - versioningit
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
        - airium
        - imageio
        - logomaker
        - matplotlib-base
        - mdtraj
        - multimethod
        - pillow  # This is the correct package name for PIL
        - pygifsicle
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.dataviz
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.dataviz
          pip_check: False
          python_version: ${{ python_min }}.*
  - package: 
      name: drugforge-docking
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-docking -vv --no-deps
      skip: True  # [win]
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools >=61.0
        - versioningit
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
        - ${{ pin_subpackage('drugforge-dataviz', exact=True) }}
        - ${{ pin_subpackage('drugforge-ml', exact=True) }}
        - ${{ pin_subpackage('drugforge-modeling', exact=True) }}
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.docking
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.docking
          pip_check: False
          python_version: ${{ python_min }}.*
  - package: 
      name: drugforge-ml
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-ml -vv --no-deps
      skip: True  # [win]
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools >=61.0
        - versioningit
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage('drugforge-alchemy', exact=True) }}
        - ${{ pin_subpackage('drugforge-cli', exact=True) }}
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
        - dgl<=2.0.0
        - dgllife
        - mtenn >=0.6.3
        - pytorch
        - pytorch_geometric >=2.5.0
        - pytorch_cluster
        - pytorch_scatter
        - pytorch_sparse
        - scipy >=1.13.1
        - wandb
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.ml
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.ml
          pip_check: False
          python_version: ${{ python_min }}.*
  - package: 
      name: drugforge-modeling
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-modeling -vv --no-deps
      skip: True  # [win]
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools >=61.0
        - versioningit
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.modeling
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.modeling
          pip_check: False
          python_version: ${{ python_min }}.*
  - package: 
      name: drugforge-simulation
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-simulation -vv --no-deps
      skip: True  # [win]
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools >=61.0
        - versioningit
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
        - openff-forcefields >=2024.04.0
        - openff-toolkit
        - openfe ~=1.0
        - openmm
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.simulation
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.simulation
          pip_check: False
          python_version: ${{ python_min }}.*
  - package: 
      name: drugforge-spectrum
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-spectrum -vv --no-deps
      skip: True  # [win]
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools >=61.0
        - versioningit
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
        - ${{ pin_subpackage('drugforge-docking', exact=True) }}
        - ${{ pin_subpackage('drugforge-simulation', exact=True) }}
        - vina
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.spectrum
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.spectrum
          pip_check: False
          python_version: ${{ python_min }}.*
  - package: 
      name: drugforge-workflows
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-workflows -vv --no-deps
      skip: True  # [win]
    requirements:
      host:
        - pip
        - python ${{ python_min }}.*
        - setuptools >=61.0
        - versioningit
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
        - ${{ pin_subpackage('drugforge-docking', exact=True) }}
        - ${{ pin_subpackage('drugforge-simulation', exact=True) }}
        - ${{ pin_subpackage('drugforge-alchemy', exact=True) }}
        - ${{ pin_subpackage('drugforge-cli', exact=True) }}
        - ${{ pin_subpackage('drugforge-dataviz', exact=True) }}
        - ${{ pin_subpackage('drugforge-ml', exact=True) }}
        - ${{ pin_subpackage('drugforge-modeling', exact=True) }}
        - ${{ pin_subpackage('drugforge-spectrum', exact=True) }}
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.workflows
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.workflows
          pip_check: False
          python_version: ${{ python_min }}.*
  - package: 
      name: drugforge
    build:
      number: ${{ number }}
      skip: True  # [win]
    requirements:
      run:
        - python >=${{ python_min }}
        - ${{ pin_subpackage('drugforge-alchemy', exact=True) }}
        - ${{ pin_subpackage('drugforge-cli', exact=True) }}
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
        - ${{ pin_subpackage('drugforge-dataviz', exact=True) }}
        - ${{ pin_subpackage('drugforge-docking', exact=True) }}
        - ${{ pin_subpackage('drugforge-ml', exact=True) }}
        - ${{ pin_subpackage('drugforge-modeling', exact=True) }}
        - ${{ pin_subpackage('drugforge-simulation', exact=True) }}
        - ${{ pin_subpackage('drugforge-spectrum', exact=True) }}
        - ${{ pin_subpackage('drugforge-workflows', exact=True) }}
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.workflows
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.alchemy
            - drugforge.cli
            - drugforge.data
            - drugforge.dataviz
            - drugforge.docking
            - drugforge.ml
            - drugforge.modeling
            - drugforge.simulation
            - drugforge.spectrum
            - drugforge.workflows
          pip_check: False
          python_version: ${{ python_min }}.*
about:
  homepage: https://drugforge.com
  summary: 'Toolkit for open antiviral drug discovery by the Choderalab (formerly ASAP)'
  description: |
    A toolkit for structure-based open antiviral drug discovery based on the work by the 
    ASAP Discovery Consortium. This project is a fork of ASAPDiscovery by the ASAP 
    Discovery Consortium. We thank the original authors for their work and for making it 
    available under MIT license. This fork is now developed and maintained independently 
    by the Chodera Lab.
  license: MIT
  license_file: LICENSE
  documentation: https://docs.drugforge.com/
  repository: https://github.com/choderalab/drugforge

extra:
  recipe-maintainers:
    - mikemhenry
    - ijpulidos 
  feedstock-name: drugforge
