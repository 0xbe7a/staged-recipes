context:
  name: drugforge
  version: "0.7.0"
  number: 0
  python_min: "3.11"

recipe:
  version: ${{ version }}

source:
  #url: https://github.com/choderalab/${{ name }}/archive/refs/tags/${{ version }}.tar.gz
  #sha256: 13f8939f64bf372f3ca0366faca7d43595a77b177b4c0252864675d8c06f601c
  git: https://github.com/choderalab/${{ name }}.git
  rev: 73f20ee1e148c18c19bca958d25fa9a95b003a1b

outputs:
  - package: 
      name: drugforge-data
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-data -vv --no-deps
    requirements:
      host:
        - pip
        - python ${{ python_min }}
        - setuptools >=61.0
        - versioningit
      run:
        - biopython
        - boto3
        - click
        - dask
        - dask-cuda
        - dask-jobqueue
        - distributed
        - gufe >=1.0.0
        - mdanalysis
        - moto
        - netifaces
        - numpy
        - openfe ~=1.0
        - openmm
        - pandas
        - plip
        - pydantic >=2.0.0a0
        - pydantic-settings
        - pymol-open-source
        - pyyaml  
        - rdkit
        - requests
        - rich <14.1.0
        - sigfig
        - typing-extensions
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.data
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.data
          pip_check: False
  - package: 
      name: drugforge-alchemy
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-alchemy -vv --no-deps
    requirements:
      host:
        - pip
        - python ${{ python_min }}
        - setuptools >=61.0
        - versioningit
      run:
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
        - alchemiscale-client
        - bokeh
        - cinnabar
        - distributed
        - gufe >=1.0.0
        - lomap2
        - networkx
        - openff-models
        - openff-qcsubmit
        - openff-toolkit
        - openff-units
        - openff-utilities
        - panel
        - perses
        - plotmol
        - pooch
        - tqdm
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.alchemy
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.alchemy
          pip_check: False
  - package: 
      name: drugforge-cli
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-cli -vv --no-deps
    requirements:
      host:
        - pip
        - python ${{ python_min }}
        - setuptools >=61.0
        - versioningit
      run:
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.cli
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.cli
          pip_check: False
  - package: 
      name: drugforge-dataviz
    build:
      number: ${{ number }}
      script: python -m pip install ./drugforge-dataviz -vv --no-deps
    requirements:
      host:
        - pip
        - python ${{ python_min }}
        - setuptools >=61.0
        - versioningit
      run:
        - ${{ pin_subpackage('drugforge-data', exact=True) }}
        - airium
        - imageio
        - logomaker
        - matplotlib-base
        - mdtraj
        - multimethod
        - pillow  # This is the correct package name for PIL
        - pygifsicle
    tests:
      # Uncomment when openeye dep is fixed
      #- script:
      #  - pytest -v --pyargs drugforge.dataviz
      #  requirements:
      #    run:
      #      - pooch
      #      - pytest
      #      - pytest
      #      - pytest-console-scripts
      #      - pytest-cov
      #      - pytest-timeout
      #      - pytest-xdist
      #      - requests-mock
      - python:
          imports:
            - drugforge.dataviz
          pip_check: False
about:
  homepage: https://drugforge.com
  summary: 'Toolkit for open antiviral drug discovery by the Choderalab (formerly ASAP)'
  description: |
    A toolkit for structure-based open antiviral drug discovery based on the work by the 
    ASAP Discovery Consortium. This project is a fork of ASAPDiscovery by the ASAP 
    Discovery Consortium. We thank the original authors for their work and for making it 
    available under MIT license. This fork is now developed and maintained independently 
    by the Chodera Lab.
  license: MIT
  license_file: LICENSE
  documentation: https://simplejson.readthedocs.io/
  repository: https://github.com/choderalab/drugforge

extra:
  recipe-maintainers:
    - mikemhenry
