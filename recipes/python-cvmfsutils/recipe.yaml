context:
  version: "0.5.0"
  python_min: "3.9"

package:
  name: python-cvmfsutils
  version: ${{ version }}

source:
  url: https://github.com/cvmfs-contrib/python-cvmfsutils/archive/v${{ version }}.tar.gz
  sha256: dece682debfdbb4e5eb0a0c7a22b28dcc97fc0846bc0c8c7715ed7d17f979a5e
  patches:
    - 40.patch

build:
  noarch: python
  number: 0
  python:
    entry_points:
      - big_catalogs = cvmfs.scripts.big_catalogs:main
      - catdirusage = cvmfs.scripts.catdirusage:main
      - cvmfs_search = cvmfs.scripts.cvmfs_search:main
  script:
    - env SETUPTOOLS_SCM_PRETEND_VERSION_FOR_PYTHON_CVMFSUTILS=${{ version }} python -m pip install . -vv --no-deps --no-build-isolation

requirements:
  host:
    - python ${{ python_min }}.*
    - pip
    - setuptools >=80
    - setuptools-scm >=8
  run:
    - python >=${{ python_min }}
    - python-dateutil >=1.4.1
    - requests >=1.1.0
    - m2crypto >=0.20.0

tests:
  - python:
      imports:
        - cvmfs
      pip_check: true
      python_version: ${{ python_min }}.*
  - script:
      - big_catalogs --help
      - catdirusage --help
      - cvmfs_search --help
      - catdirusage http://cvmfs-stratum-one.cern.ch/cvmfs/lhcb-condb.cern.ch /

about:
  homepage: https://github.com/cvmfs-contrib/python-cvmfsutils
  license: BSD-3-Clause
  license_file: COPYING
  summary: Inspect CernVM-FS repositories
  description: |
    Python utilities for inspection of CernVM-FS repositories.
    Allows browsing file catalog hierarchies, inspecting repository 
    manifests, and exploring named snapshot histories.
  repository: https://github.com/cvmfs-contrib/python-cvmfsutils

extra:
  recipe-maintainers:
    - chrisburr
