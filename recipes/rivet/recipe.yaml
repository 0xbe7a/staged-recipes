schema_version: 1

context:
  name: rivet
  version: 3.1.11

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://gitlab.com/hepcedar/rivet/-/archive/rivet-${{ version }}/rivet-rivet-${{ version }}.tar.gz
  sha256: 0007e8d60d2fe78deb4481d46f4a6a2f1b6595180cb93bbfebdbd5e32fc64c0a

build:
  number: 0
  skip:
    # FIXME: Get osx builds working
    - not linux
    # FIXME: Make patch for distutils deprecation and backport YODA v1.9.11
    - match(python, ">3.11")

requirements:
  build:
    - if: build_platform != target_platform
      then:
        - python
        - cross-python_${{ target_platform }}
        - cython
    - ${{ stdlib('c') }}
    - ${{ compiler('cxx') }}
    - automake
    - libtool
    - make
    - pkg-config
    - gnuconfig
    # Tools that autotools looks for
    - sed
    - grep
    - gawk
  host:
    - python
    - hepmc3 >=3.2.6,<3.3.0
    - yoda <2
    - fastjet-contrib
    - cython
  run:
    - python
    - hepmc3 >=3.2.6,<3.3.0
    - yoda <2
    - fastjet-contrib
    - hdf5
    - highfive
    - matplotlib-base
    - requests

tests:
  - python:
      imports:
        - rivet
  - files:
      source:
        - test/testBeams.cc
        - test/testCmp.cc
        - test/testMath.cc
        - test/testMatVec.cc
        - test/testNaN.cc
        - test/testApi.hepmc
    script:
      # PY_VER is not available in 'tests' section with rattler-build
      - export PY_VER=$(python -c "import sys; print(f'{sys.version_info.major}.{sys.version_info.minor}')")

      - test -f $PREFIX/bin/make-plots
      - test -f $PREFIX/bin/rivet
      - test -f $PREFIX/bin/rivet-build
      - test -f $PREFIX/bin/rivet-buildplugin
      - test -f $PREFIX/bin/rivet-cmphistos
      - test -f $PREFIX/bin/rivet-config
      - test -f $PREFIX/bin/rivet-diffhepdata
      - test -f $PREFIX/bin/rivet-diffhepdata-all
      - test -f $PREFIX/bin/rivet-findid
      - test -f $PREFIX/bin/rivet-merge
      - test -f $PREFIX/bin/rivet-mkanalysis
      - test -f $PREFIX/bin/rivet-mkhtml
      - test -f $PREFIX/bin/rivet-mkhtml-mpl
      - test -f $PREFIX/bin/rivet-mkvaldir
      - test -f $PREFIX/bin/rivet-which

      - test -f $PREFIX/etc/bash_completion.d/rivet-completion

      - test -f $PREFIX/include/Rivet/Analyses/MC_Cent_pPb.hh
      - test -f $PREFIX/include/Rivet/Analyses/MC_JetAnalysis.hh
      - test -f $PREFIX/include/Rivet/Analyses/MC_JetSplittings.hh
      - test -f $PREFIX/include/Rivet/Analyses/MC_ParticleAnalysis.hh
      - test -f $PREFIX/include/Rivet/Analysis.hh
      - test -f $PREFIX/include/Rivet/AnalysisBuilder.hh
      - test -f $PREFIX/include/Rivet/AnalysisHandler.hh
      - test -f $PREFIX/include/Rivet/AnalysisInfo.hh
      - test -f $PREFIX/include/Rivet/AnalysisLoader.hh
      - test -f $PREFIX/include/Rivet/Config/RivetCommon.hh
      - test -f $PREFIX/include/Rivet/Config/RivetConfig.hh
      - test -f $PREFIX/include/Rivet/Event.hh
      - test -f $PREFIX/include/Rivet/Jet.fhh
      - test -f $PREFIX/include/Rivet/Jet.hh
      - test -f $PREFIX/include/Rivet/Math/Constants.hh
      - test -f $PREFIX/include/Rivet/Math/LorentzTrans.hh
      - test -f $PREFIX/include/Rivet/Math/Math.hh
      - test -f $PREFIX/include/Rivet/Math/MathConstants.hh
      - test -f $PREFIX/include/Rivet/Math/MathUtils.hh
      - test -f $PREFIX/include/Rivet/Math/Matrices.hh
      - test -f $PREFIX/include/Rivet/Math/Matrix3.hh
      - test -f $PREFIX/include/Rivet/Math/MatrixN.hh
      - test -f $PREFIX/include/Rivet/Math/Units.hh
      - test -f $PREFIX/include/Rivet/Math/Vector2.hh
      - test -f $PREFIX/include/Rivet/Math/Vector3.hh
      - test -f $PREFIX/include/Rivet/Math/Vector4.hh
      - test -f $PREFIX/include/Rivet/Math/VectorN.hh
      - test -f $PREFIX/include/Rivet/Math/Vectors.hh
      - test -f $PREFIX/include/Rivet/Particle.fhh
      - test -f $PREFIX/include/Rivet/Particle.hh
      - test -f $PREFIX/include/Rivet/ParticleBase.hh
      - test -f $PREFIX/include/Rivet/Projection.fhh
      - test -f $PREFIX/include/Rivet/Projection.hh
      - test -f $PREFIX/include/Rivet/ProjectionApplier.hh
      - test -f $PREFIX/include/Rivet/ProjectionHandler.hh
      - test -f $PREFIX/include/Rivet/Projections/AliceCommon.hh
      - test -f $PREFIX/include/Rivet/Projections/AtlasCommon.hh
      - test -f $PREFIX/include/Rivet/Projections/AxesDefinition.hh
      - test -f $PREFIX/include/Rivet/Projections/Beam.hh
      - test -f $PREFIX/include/Rivet/Projections/BeamThrust.hh
      - test -f $PREFIX/include/Rivet/Projections/CentralEtHCM.hh
      - test -f $PREFIX/include/Rivet/Projections/CentralityProjection.hh
      - test -f $PREFIX/include/Rivet/Projections/ChargedFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/ChargedLeptons.hh
      - test -f $PREFIX/include/Rivet/Projections/ConstLossyFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/DISDiffHadron.hh
      - test -f $PREFIX/include/Rivet/Projections/DISFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/DISKinematics.hh
      - test -f $PREFIX/include/Rivet/Projections/DISLepton.hh
      - test -f $PREFIX/include/Rivet/Projections/DISRapidityGap.hh
      - test -f $PREFIX/include/Rivet/Projections/DecayedParticles.hh
      - test -f $PREFIX/include/Rivet/Projections/DirectFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/DressedLeptons.hh
      - test -f $PREFIX/include/Rivet/Projections/EventMixingFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/FParameter.hh
      - test -f $PREFIX/include/Rivet/Projections/FastJets.hh
      - test -f $PREFIX/include/Rivet/Projections/FinalPartons.hh
      - test -f $PREFIX/include/Rivet/Projections/FinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/FinalStates.hh
      - test -f $PREFIX/include/Rivet/Projections/GammaGammaFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/GammaGammaKinematics.hh
      - test -f $PREFIX/include/Rivet/Projections/GammaGammaLeptons.hh
      - test -f $PREFIX/include/Rivet/Projections/GeneratedPercentileProjection.hh
      - test -f $PREFIX/include/Rivet/Projections/HadronicFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/HeavyHadrons.hh
      - test -f $PREFIX/include/Rivet/Projections/Hemispheres.hh
      - test -f $PREFIX/include/Rivet/Projections/HepMCHeavyIon.hh
      - test -f $PREFIX/include/Rivet/Projections/IdentifiedFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/ImpactParameterProjection.hh
      - test -f $PREFIX/include/Rivet/Projections/IndirectFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/InitialQuarks.hh
      - test -f $PREFIX/include/Rivet/Projections/InvMassFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/InvisibleFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/JetAlg.hh
      - test -f $PREFIX/include/Rivet/Projections/JetFinder.hh
      - test -f $PREFIX/include/Rivet/Projections/JetShape.hh
      - test -f $PREFIX/include/Rivet/Projections/LeadingParticlesFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/LossyFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/METFinder.hh
      - test -f $PREFIX/include/Rivet/Projections/MergedFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/MissingMomentum.hh
      - test -f $PREFIX/include/Rivet/Projections/NeutralFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/NonHadronicFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/NonPromptFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/ParisiTensor.hh
      - test -f $PREFIX/include/Rivet/Projections/ParticleFinder.hh
      - test -f $PREFIX/include/Rivet/Projections/PartonicTops.hh
      - test -f $PREFIX/include/Rivet/Projections/PercentileProjection.hh
      - test -f $PREFIX/include/Rivet/Projections/PrimaryHadrons.hh
      - test -f $PREFIX/include/Rivet/Projections/PrimaryParticles.hh
      - test -f $PREFIX/include/Rivet/Projections/PromptFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/PxConePlugin.hh
      - test -f $PREFIX/include/Rivet/Projections/RHICCommon.hh
      - test -f $PREFIX/include/Rivet/Projections/SingleValueProjection.hh
      - test -f $PREFIX/include/Rivet/Projections/SmearedJets.hh
      - test -f $PREFIX/include/Rivet/Projections/SmearedMET.hh
      - test -f $PREFIX/include/Rivet/Projections/SmearedParticles.hh
      - test -f $PREFIX/include/Rivet/Projections/Smearing.hh
      - test -f $PREFIX/include/Rivet/Projections/Sphericity.hh
      - test -f $PREFIX/include/Rivet/Projections/Spherocity.hh
      - test -f $PREFIX/include/Rivet/Projections/TauFinder.hh
      - test -f $PREFIX/include/Rivet/Projections/Thrust.hh
      - test -f $PREFIX/include/Rivet/Projections/TriggerCDFRun0Run1.hh
      - test -f $PREFIX/include/Rivet/Projections/TriggerCDFRun2.hh
      - test -f $PREFIX/include/Rivet/Projections/TriggerProjection.hh
      - test -f $PREFIX/include/Rivet/Projections/TriggerUA5.hh
      - test -f $PREFIX/include/Rivet/Projections/UndressBeamLeptons.hh
      - test -f $PREFIX/include/Rivet/Projections/UnstableFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/UnstableParticles.hh
      - test -f $PREFIX/include/Rivet/Projections/UserCentEstimate.hh
      - test -f $PREFIX/include/Rivet/Projections/VetoedFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/VisibleFinalState.hh
      - test -f $PREFIX/include/Rivet/Projections/WFinder.hh
      - test -f $PREFIX/include/Rivet/Projections/ZFinder.hh
      - test -f $PREFIX/include/Rivet/Rivet.hh
      - test -f $PREFIX/include/Rivet/Run.hh
      - test -f $PREFIX/include/Rivet/Tools/AliceCommon.hh
      - test -f $PREFIX/include/Rivet/Tools/AtlasCommon.hh
      - test -f $PREFIX/include/Rivet/Tools/BeamConstraint.hh
      - test -f $PREFIX/include/Rivet/Tools/BinnedHistogram.hh
      - test -f $PREFIX/include/Rivet/Tools/CentralityBinner.hh
      - test -f $PREFIX/include/Rivet/Tools/Cmp.fhh
      - test -f $PREFIX/include/Rivet/Tools/Cmp.hh
      - test -f $PREFIX/include/Rivet/Tools/Correlators.hh
      - test -f $PREFIX/include/Rivet/Tools/Cutflow.hh
      - test -f $PREFIX/include/Rivet/Tools/Cuts.fhh
      - test -f $PREFIX/include/Rivet/Tools/Cuts.hh
      - test -f $PREFIX/include/Rivet/Tools/Exceptions.hh
      - test -f $PREFIX/include/Rivet/Tools/ExptSmearingFunctions.hh
      - test -f $PREFIX/include/Rivet/Tools/JetSmearingFunctions.hh
      - test -f $PREFIX/include/Rivet/Tools/JetUtils.hh
      - test -f $PREFIX/include/Rivet/Tools/Logging.hh
      - test -f $PREFIX/include/Rivet/Tools/MendelMin.hh
      - test -f $PREFIX/include/Rivet/Tools/MomentumSmearingFunctions.hh
      - test -f $PREFIX/include/Rivet/Tools/ParticleBaseUtils.hh
      - test -f $PREFIX/include/Rivet/Tools/ParticleIdUtils.hh
      - test -f $PREFIX/include/Rivet/Tools/ParticleName.hh
      - test -f $PREFIX/include/Rivet/Tools/ParticleSmearingFunctions.hh
      - test -f $PREFIX/include/Rivet/Tools/ParticleUtils.hh
      - test -f $PREFIX/include/Rivet/Tools/Percentile.hh
      - test -f $PREFIX/include/Rivet/Tools/PrettyPrint.hh
      - test -f $PREFIX/include/Rivet/Tools/RHICCommon.hh
      - test -f $PREFIX/include/Rivet/Tools/Random.hh
      - test -f $PREFIX/include/Rivet/Tools/RivetFastJet.hh
      - test -f $PREFIX/include/Rivet/Tools/RivetHTT.hh
      - test -f $PREFIX/include/Rivet/Tools/RivetHepMC.hh
      - test -f $PREFIX/include/Rivet/Tools/RivetLWTNN.hh
      - test -f $PREFIX/include/Rivet/Tools/RivetMT2.hh
      - test -f $PREFIX/include/Rivet/Tools/RivetONNXrt.hh
      - test -f $PREFIX/include/Rivet/Tools/RivetPaths.hh
      - test -f $PREFIX/include/Rivet/Tools/RivetSTL.hh
      - test -f $PREFIX/include/Rivet/Tools/RivetYODA.hh
      - test -f $PREFIX/include/Rivet/Tools/SmearingFunctions.hh
      - test -f $PREFIX/include/Rivet/Tools/TypeTraits.hh
      - test -f $PREFIX/include/Rivet/Tools/Utils.hh

      - test -f $PREFIX/lib/Rivet/RivetALICEAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetATLASAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetBABARAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetBELLEAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetBESAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetCDFAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetCESRAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetCMSAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetD0Analyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetDORISAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetFrascatiAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetHERAAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetLEPAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetLHCbAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetLHCfAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetMCAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetMiscAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetNovosibirskAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetOrsayAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetPetraAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetRHICAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetSLACAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetSPSAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetTOTEMAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/Rivet/RivetTristanAnalyses${SHLIB_EXT}
      - test -f $PREFIX/lib/libRivet${SHLIB_EXT}
      - test -f $PREFIX/lib/pkgconfig/rivet.pc
      - test -f $PREFIX/lib/python${PY_VER}/site-packages/rivet/__init__.py
      - test -f $PREFIX/lib/python${PY_VER}/site-packages/rivet/aopaths.py
      - test -f $PREFIX/lib/python${PY_VER}/site-packages/rivet/core${SHLIB_EXT}
      - test -d $PREFIX/lib/python${PY_VER}/site-packages/rivet/hepdatapatches/
      - test -f $PREFIX/lib/python${PY_VER}/site-packages/rivet/hepdatautils.py
      - test -f $PREFIX/lib/python${PY_VER}/site-packages/rivet/plotinfo.py
      - test -f $PREFIX/lib/python${PY_VER}/site-packages/rivet/plotting/__init__.py
      - test -f $PREFIX/lib/python${PY_VER}/site-packages/rivet/plotting/conversion_tools.py
      - test -f $PREFIX/lib/python${PY_VER}/site-packages/rivet/plotting/make_plots.py
      - test -f $PREFIX/lib/python${PY_VER}/site-packages/rivet/plotting/plot2yaml.py
      - test -f $PREFIX/lib/python${PY_VER}/site-packages/rivet/spiresbib.py
      - test -f $PREFIX/lib/python${PY_VER}/site-packages/rivet/util.py

      - test -d $PREFIX/share/Rivet/
      - test -f $PREFIX/share/Rivet/rivet-completion
      - test -f $PREFIX/share/Rivet/texmf/cnf/texmf.cnf
      - test -d $PREFIX/share/Rivet/texmf/dvips/
      - test -d $PREFIX/share/Rivet/texmf/tex/generic/
      - test -d $PREFIX/share/Rivet/texmf/tex/latex/

      - rivet-config --help
      - rivet-build --help
      - rivet-which --help
      - rivet-mkhtml --help
      - rivet-mkanalysis --help
      - rivet-merge --help
      - rivet-findid --help
      - rivet-diffhepdata-all --help
      - rivet-diffhepdata --help
      - rivet-cmphistos --help
      - rivet-buildplugin --help
      - rivet --help
      - make-plots --help
      - rivet-mkvaldir --help

      - $CXX test/testBeams.cc -o testBeams $CXXFLAGS $LDFLAGS -lRivet
      - ./testBeams
      - $CXX test/testCmp.cc -o testCmp $CXXFLAGS $LDFLAGS -lRivet
      - ./testCmp
      - $CXX test/testMath.cc -o testMath $CXXFLAGS $LDFLAGS -lRivet
      - ./testMath
      - $CXX test/testMatVec.cc -o testMatVec $CXXFLAGS $LDFLAGS -lRivet
      - ./testMatVec
      - cd test
      - $CXX testNaN.cc -o testNaN $CXXFLAGS $LDFLAGS -lm -lHepMC3 -lRivet
      - ./testNaN testApi.hepmc

about:
  license: GPL-3.0-only
  license_file: COPYING
  summary: 'Rivet: the particle-physics MC analysis toolkit'
  description: |
    The Rivet toolkit (Robust Independent Validation of Experiment and Theory)
    is a system for validation of Monte Carlo event generators. It provides a
    large (and ever growing) set of experimental analyses useful for MC
    generator development, validation, and tuning, as well as a convenient
    infrastructure for adding your own analyses.

    Rivet is the most widespread way by which analysis code from the LHC and
    other high-energy collider experiments is preserved for comparison to and
    development of future theory models. It is used by phenomenologists, MC
    generator developers, and experimentalists on the LHC and other facilities.
  homepage: https://gitlab.com/hepcedar/rivet/
  repository: https://gitlab.com/hepcedar/rivet/
  documentation: https://rivet.hepforge.org/

extra:
  recipe-maintainers:
    - matthewfeickert
