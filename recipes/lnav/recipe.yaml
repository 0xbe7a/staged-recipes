context:
  name: lnav
  version: "v0.12.4"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://github.com/tstack/${{ name }}/archive/refs/tags/${{ version }}.tar.gz
  sha256: ee6ea75cbfd736f6ad8b32212883e45a1a64e48085a14757d2cfffa90ebb8e75

build:
  number: 0
  skip:
    - win
  script: |
    ./autogen.sh
    ./configure --prefix=${{ PREFIX }} \
      --with-sqlite3=${{ PREFIX }} \
      --with-readline=${{ PREFIX }} \
      --with-libarchive=${{ PREFIX }} \
      --with-ncurses=${{ PREFIX }} ${{ CFLAGS }} ${{ LDFLAGS }}
    make -j${{ CPU_COUNT }} V=1
    make install
    cargo-bundle-licenses --format yaml --output THIRDPARTY.yml

requirements:
  build:
    - ${{ compiler('cxx') }}
    - ${{ compiler('rust') }}
    - autoconf
    - automake
    - make
    - re2c
    - pcre2
    - zlib
    - cargo-bundle-licenses
  host:
    - libarchive
    - libunistring
    - pcre2
    - ncurses
    - readline
    - sqlite
    - zlib
  run:
    - bzip2
    - curl

tests:
  - script:
    - lnav -V

about:
  homepage: https://lnav.org/
  license: BSD-2-Clause
  license_family: BSD-2
  license_file:
    - LICENSE
    - THIRDPARTY.yml
  summary: "A log file viewer for the terminal"
  description: |
    The Logfile Navigator is a log file viewer for the terminal. Given a set of files/directories, lnav will:

      - decompress as needed;
      - detect their format;
      - merge the files by time into a single view;
      - tail the files, follow renames, find new files in directories;
      - build an index of errors and warnings;
      - pretty-print JSON-lines.

    Then, in the lnav TUI, you can:

      - jump quickly to the previous/next error (press e/E);
      - search using regular expressions (press /);
      - highlight text with a regular expression (:highlight command);
      - filter messages using regular expressions or SQLite expressions;
      - pretty-print structured text (press P);
      - view a histogram of messages over time (press i);
      - analyze messages using SQLite (press ;)
  repository: https://github.com/tstack/lnav
  documentation: https://docs.lnav.org/en/v0.12.4/

extra:
  recipe-maintainers:
    - eunos-1128
