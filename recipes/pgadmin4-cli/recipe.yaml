context:
  name: pgadmin4-cli
  version: "9.2"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  - url: https://ftp.postgresql.org/pub/pgadmin/pgadmin4/v${{ version }}/source/pgadmin4-${{ version }}.tar.gz
    sha256: 3b41fd0ec898d474c4166a6aa3fe545ece0e3d0faf99a2ede7393331e41fc125
    patches:
      # speaklater3 implements a python 2.x support, its github homepage was deleted
      # replacing speaklater3 req with speaklater (https://github.com/pgadmin-org/pgadmin4/issues/8673)
      - patches/speaklater-requirements.txt.patch
      - patches/psycopg-requirements.txt.patch

build:
  number: 0
  python:
    entry_points:
      - pgadmin4 = pgadmin4.pgAdmin4:main
      - pgadmin4-cli = pgadmin4.setup:main

requirements:
  host:
    - electron
    - pgadmin4-py ==${{ version }}
  run:
    - pgadmin4-py ==${{ version }}
    - if: not unix
      then: pywinpty 2.0.*

tests:
  - package_contents:
      files:
        - if: linux
          then:
            - Menu/pgadmin4.desktop
        - if: osx
          then:
            - Menu/pgadmin4.app
        - if: not linux or not osx
          then:
            - Menu/pgadmin4.lnk
        - ${{ "Library/" if not unix else "" }}share/pgadmin4/icons/*
        - ${{ "Library/" if not unix else "" }}share/pgadmin4/pgAdmin4.wsgi
      bin:
        - pgadmin4
        - pgadmin4-cli
  - script: cd testing && python run_simple_pgadmin4.py
    requirements: { run: ["python"] }
    files: { recipe: [testing/] }
  - script: cd testing && python run_simple_setup.py
    requirements: { run: ["python"] }
    files: { recipe: [testing/] }

about:
  homepage: https://github.com/pgadmin-org/pgadmin4
  summary: 'pgAdmin 4 is a rewrite of the popular pgAdmin3 management tool for the PostgreSQL'
  description: |
    pgAdmin is the most popular and feature rich Open Source administration and
    development platform for PostgreSQL, the most advanced Open Source database in the world.
  license: PostgreSQL
  license_file:
    - LICENSE
  documentation: https://www.pgadmin.org/
  repository: https://github.com/pgadmin-org/pgadmin4

extra:
  recipe-maintainers:
    - MementoRC
