context:
  name: webkit2gtk4.1
  version: "2.48.4"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://webkitgtk.org/releases/webkitgtk-${{ version }}.tar.xz
  sha256: f62c1077d3a0f63d50259a802d1143be5d4d0c7c4c05e581819af1ce935afab3

build:
  number: 0
  skip: not linux
  script:
    - |
      cmake_args=(
        -DPORT=GTK
        -DENABLE_BUBBLEWRAP_SANDBOX=OFF
        -DENABLE_DOCUMENTATION=OFF
        -DENABLE_GAMEPAD=OFF
        -DENABLE_MINIBROWSER=ON
        -DENABLE_SPEECH_SYNTHESIS=OFF
        -DUSE_AVIF=ON
        -DUSE_GTK4=OFF
        -DUSE_JPEGXL=ON
        -DUSE_LIBBACKTRACE=OFF
        -DUSE_LIBHYPHEN=OFF
        -DUSE_GBM=OFF # TODO: Requires libgbm, not packaged
        -DUSE_JPEGXL=OFF # TODO: Requires jpeg-xl, not packaged
        -DUSE_WOFF2=OFF # TODO: Requires woff2, not packaged
        -DUSE_SYSTEM_SYSPROF_CAPTURE=NO # TODO: Requires sysprof, not packaged
        -DUSE_GSTREAMER_TRANSCODER=NO # TODO: gst-plugins-bad is too old (1.24 instead of 1.26)
      )
    - cmake ${CMAKE_ARGS} -S . -B build -GNinja "${cmake_args[@]}"
    - cmake --build build -- -j 8
    - cmake --install build

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ stdlib('c') }}
    - pkg-config
    - cmake
    - ninja
  host:
    - perl
    - ruby
    - glib
    - gtk3
    - libgcrypt
    - libtasn1
    - libsoup
    - libxslt
    - libsecret
    - gobject-introspection
    - libdrm
    - enchant
    - zlib
    - fontconfig
    - expat
    - wayland-protocols
    - libpng
    - libavif
    - libsystemd
    - lcms2
    - gstreamer
    - gst-plugins-base
    - gst-plugins-good
    - gperf
    - unifdef
    - epoxy
    - libegl-devel
    - xorg-xorgproto

tests:
  - script: return 0 # TODO

about:
  homepage: https://webkitgtk.org
  summary: WebKitGTK for GTK 3 and libsoup 3
  description: |
    WebKitGTK is a full-featured port of the WebKit rendering engine, 
    suitable for projects requiring any kind of web integration, from 
    hybrid HTML/CSS applications to full-fledged web browsers.
  license: LGPL-2.1
  license_file: Source/WebCore/LICENSE-LGPL-2.1

extra:
  recipe-maintainers:
    - haecker-felix
    - Hofer-Julian
