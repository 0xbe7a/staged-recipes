context:
  name: webkit2gtk4.1
  version: "2.48.4"

package:
  name: ${{ name|lower }}
  version: ${{ version }}

source:
  url: https://webkitgtk.org/releases/webkitgtk-${{ version }}.tar.xz
  sha256: f62c1077d3a0f63d50259a802d1143be5d4d0c7c4c05e581819af1ce935afab3

build:
  number: 0
  skip: not linux
  script:
    - |
      cmake_args=(
        # TODO: Package xdg-dbus-proxy
        -DENABLE_BUBBLEWRAP_SANDBOX=OFF
        -DPORT=GTK
        -DENABLE_DOCUMENTATION=OFF
        -DENABLE_GAMEPAD=OFF
        -DUSE_GTK4=OFF
        -DUSE_LIBBACKTRACE=OFF 
        # TODO: staged-recipes #30724
        -DUSE_LIBHYPHEN=OFF 
        # TODO: staged-recipes #30722
        -DUSE_WOFF2=OFF # TODO
        # libmesa package is built without screen rendering capabilities so we can't enable GBM
        # https://github.com/conda-forge/mesalib-feedstock/blob/f0c17a763eda1e0ef13cd1aa81d597d50fde0d80/recipe/meta.yaml#L54
        -DUSE_GBM=OFF
        -DUSE_SYSTEM_SYSPROF_CAPTURE=NO 
        # TODO: gst-plugins-bad-feedstock #82
        -DUSE_GSTREAMER_TRANSCODER=NO 
      )
    - cmake ${CMAKE_ARGS} -S . -B build -GNinja "${cmake_args[@]}"
    - cmake --build build
    - cmake --install build

requirements:
  build:
    - ${{ compiler('c') }}
    - ${{ compiler('cxx') }}
    - ${{ stdlib('c') }}
    - pkg-config
    - cmake
    - ninja
  host:
    - perl
    - ruby
    - glib
    - gtk3
    - libgcrypt
    - libtasn1
    - libsoup
    - libxslt
    - libsecret
    - gobject-introspection
    - libdrm
    - enchant
    - zlib
    - fontconfig
    - expat
    - wayland-protocols
    - libpng
    - libavif
    - libsystemd
    - lcms2
    - gstreamer
    - gst-plugins-base
    - gst-plugins-good
    - gperf
    - unifdef
    - epoxy
    - libegl-devel
    - xorg-xorgproto
    - flite-dev
    - libjxl
    - libseccomp
    - bubblewrap

tests:
  - script: return 0 # TODO

about:
  homepage: https://webkitgtk.org
  summary: WebKitGTK for GTK 3 and libsoup 3
  description: |
    WebKitGTK is a full-featured port of the WebKit rendering engine, 
    suitable for projects requiring any kind of web integration, from 
    hybrid HTML/CSS applications to full-fledged web browsers.
  license: LGPL-2.1
  license_file: Source/WebCore/LICENSE-LGPL-2.1

extra:
  recipe-maintainers:
    - haecker-felix
    - Hofer-Julian
