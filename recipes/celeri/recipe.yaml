context:
  version: "0.0.3"
  python_min: "3.11"
  python_check_max: "3.13"

package:
  name: celeri
  version: ${{ version }}

source:
- url: https://pypi.org/packages/source/c/celeri/celeri-${{ version }}.tar.gz
  sha256: cca3f52089649cf67882a4d96e8f630001374682b5f0f4eb2041eb3cd9bfa307

build:
  noarch: python
  script: ${{ PYTHON }} -m pip install . -vv --no-deps --no-build-isolation
  python:
    entry_points:
    - celeri-create-grid-station = celeri.scripts.create_grid_station:main
    - celeri-forward = celeri.scripts.celeri_forward:main
    - celeri-msh2stl = celeri.scripts.msh2stl:main
    - celeri-segmesh = celeri.scripts.segmesh:main
    - celeri-snap-segments = celeri.scripts.snap_segments:main
    - celeri-solve = celeri.scripts.celeri_solve:main
    - celeri-stl2msh = celeri.scripts.stl2msh:main

requirements:
  host:
  - python ${{ python_min }}.*
  - hatchling
  - hatch-vcs
  - hatch-fancy-pypi-readme
  - pip
  run:
  - python >=${{ python_min }}
  - addict
  - cartopy
  - colorcet
  - cutde >=25.7.24
  - cvxopt
  - cvxpy
  - gmsh
  - h5py
  - ipykernel
  - ipython
  - loguru
  - matplotlib
  - meshio
  - numpy
  - pandas
  - papermill
  - pydantic
  - pyproj
  - pytest
  - scipy
  - shapely
  - spherical-geometry
  - tqdm
  - xarray
  - zarr

tests:
- python:
    python_version:
    - ${{ python_min }}.*
    - ${{ python_check_max }}.*
    imports:
    - celeri
    pip_check: true
- requirements:
    run:
      - python ${{ python_min }}.*
  script:
    - celeri-solve --help
    - celeri-snap-segments --help
    - celeri-segmesh --help
    - celeri-msh2stl --help
    - celeri-stl2msh --help
    - celeri-forward --help
    - celeri-create-grid-station --help
    - python -c "from importlib.metadata import version; v = version('celeri'); print(v); assert v == '${{ version }}'"

about:
  summary: Next generation earthquake cycle kinematics
  homepage: https://github.com/brendanjmeade/celeri
  repository: https://github.com/brendanjmeade/celeri
  license: MIT
  license_file: LICENSE

extra:
  feedstock_name: celeri
  recipe-maintainers:
    - aseyboldt
    - brendanjmeade
    - maresb
