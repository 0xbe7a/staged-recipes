schema_version: 1

context:
  name: libvalkey
  version: "0.1.0"

package:
  name: "${{ name }}"
  version: "${{ version }}"

source:
  url: https://github.com/valkey-io/libvalkey/archive/refs/tags/${{ version }}.zip
  sha256: "118e4cf50daf32645d267740f431e81c91bc85f332ea14a8051ddab59bba79c5"

build:
  number: 0
  script:
    content:
      - if: linux
        then: cmake $CMAKE_ARGS -DENABLE_TLS=1 -DENABLE_RDMA=1 -S $SRC_DIR
      - if: osx
        then: cmake $CMAKE_ARGS -DENABLE_TLS=1 -S $SRC_DIR
      - if: win
        then: "cmake %CMAKE_ARGS% -DENABLE_TLS=1 -S %SRC_DIR%"

      - cmake --build . --config Release
      - cmake --install .

requirements:
  build:
    - "${{ compiler('c') }}"
    - "${{ stdlib('c') }}"
    - "${{ compiler('cxx') }}"
    - if: unix
      then: make
    - cmake

  host:
    - openssl >=3
    - if: linux
      then: rdma-core

tests:
  - script:
      - if: unix
        then:
          - test -f ${PREFIX}/include/valkey/valkey.h
          - test -f ${PREFIX}/lib/libvalkey${SHLIB_EXT}

about:
  license: MIT
  license_file:
    - COPYING
  summary: Valkey client library in C
  description: |
    Libvalkey is the official C client for the [Valkey](https://valkey.io) database. It also supports any server that uses the `RESP` protocol (version 2 or 3). This project supports both standalone and cluster modes.
  homepage: https://github.com/valkey-io/libvalkey
  repository: https://github.com/valkey-io/libvalkey

extra:
  recipe-maintainers:
    - trim21
