# yaml-language-server: $schema=https://raw.githubusercontent.com/prefix-dev/recipe-format/main/schema.json

schema_version: 1

context:
  name: libvalkey
  version: "0.1.0"

package:
  name: "${{ name }}"
  version: "${{ version }}"

source:
  url: https://github.com/valkey-io/libvalkey/archive/refs/tags/${{ version }}.zip
  sha256: "118e4cf50daf32645d267740f431e81c91bc85f332ea14a8051ddab59bba79c5"

build:
  number: 0
  script:
    env:
      CMAKE_GENERATOR: "Ninja"
    content:
      - if: linux
        then: cmake ${CMAKE_ARGS} -DENABLE_TLS=1 -DENABLE_RDMA=1 -B build .
      - if: osx
        then: cmake ${CMAKE_ARGS} -DENABLE_TLS=1 -B build .
      - if: win
        then: "cmake -DCMAKE_INSTALL_PREFIX=%LIBRARY_PREFIX% -B build %SRC_DIR%"
      - ninja -C build -v install

requirements:
  build:
    - '${{ compiler('c') }}'
    - '${{ stdlib("c") }}'
    - ninja
    - cmake

  host:
    - openssl >=3
    - if: linux
      then: rdma-core

about:
  license: MIT
  license_file:
    - COPYING
  summary: Valkey client library in C
  description: |
    Libvalkey is the official C client for the [Valkey](https://valkey.io) database. It also supports any server that uses the `RESP` protocol (version 2 or 3). This project supports both standalone and cluster modes.
  homepage: https://github.com/valkey-io/libvalkey
  repository: https://github.com/valkey-io/libvalkey

extra:
  recipe-maintainers:
    - trim21
